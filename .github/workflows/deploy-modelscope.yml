# é­”æ­åˆ›ç©ºé—´è‡ªåŠ¨éƒ¨ç½²
# å½“æŽ¨é€åˆ° main åˆ†æ”¯æ—¶è‡ªåŠ¨éƒ¨ç½²åˆ° ModelScope
#
# é…ç½®æ­¥éª¤ï¼š
#   1. åœ¨ GitHub ä»“åº“ Settings -> Secrets and variables -> Actions
#   2. æ·»åŠ  Repository secret: MODELSCOPE_TOKEN
#   3. å€¼ä¸ºä½ çš„é­”æ­ Access Tokenï¼ˆä»Ž https://modelscope.cn/my/myaccesstoken èŽ·å–ï¼‰

name: Deploy to ModelScope

on:
  push:
    branches:
      - main
  # ä¹Ÿæ”¯æŒæ‰‹åŠ¨è§¦å‘
  workflow_dispatch:

jobs:
  deploy:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v4
        with:
          fetch-depth: 0  # èŽ·å–å®Œæ•´åŽ†å²ï¼Œç”¨äºŽæŽ¨é€

      - name: Configure Git
        run: |
          git config user.name "GitHub Actions"
          git config user.email "actions@github.com"

      - name: Deploy to ModelScope
        env:
          MODELSCOPE_TOKEN: ${{ secrets.MODELSCOPE_TOKEN }}
        run: |
          if [ -z "$MODELSCOPE_TOKEN" ]; then
            echo "Error: MODELSCOPE_TOKEN secret not configured"
            echo "Please add MODELSCOPE_TOKEN in repository Settings -> Secrets -> Actions"
            exit 1
          fi

          # æ·»åŠ  ModelScope remote
          git remote add modelscope "http://oauth2:${MODELSCOPE_TOKEN}@www.modelscope.cn/studios/hasmokan/The-Reverse-Turing-Test.git"

          # æŽ¨é€åˆ°é­”æ­ï¼ˆmain -> masterï¼‰
          # ä½¿ç”¨ --force å› ä¸º GitHub æ˜¯ä¸»ä»“åº“ï¼ŒModelScope ä»…ä½œä¸ºéƒ¨ç½²ç›®æ ‡
          git push --force modelscope main:master

          echo ""
          echo "âœ… Deploy complete!"
          echo "ðŸ”— View your app at: https://modelscope.cn/studios/hasmokan/The-Reverse-Turing-Test"
