import fs from 'node:fs';
import path from 'node:path';
import { fileURLToPath } from 'node:url';

const __filename = fileURLToPath(import.meta.url);
const __dirname = path.dirname(__filename);

const COCOS_ROOT = path.resolve(__dirname, '..');
const OUTPUT_PATH = path.resolve(COCOS_ROOT, 'assets/scripts/data/PresetFishBase64.ts');

const PRESET_IDS = [0, 1, 2];
const REMOTE_BASE_URL = (
  process.env.PRESET_FISH_REMOTE_BASE_URL
  || 'https://turing-test-1319469298.cos.ap-guangzhou.myqcloud.com'
).replace(/\/+$/, '');

function readPresetItems() {
  return PRESET_IDS.map((id) => {
    return {
      id: `fish_${id}`,
      imageData: `${REMOTE_BASE_URL}/fish_${id}.png?imageSlim`,
    };
  });
}

function buildModule(items) {
  const lines = [];
  lines.push('// Auto-generated by scripts/sync-preset-fish-base64.mjs');
  lines.push('// Source: remote preset fish URLs');
  lines.push('');
  lines.push('export interface PresetFishBase64Entry {');
  lines.push('    id: string;');
  lines.push('    imageData: string;');
  lines.push('}');
  lines.push('');
  lines.push('export const PRESET_FISH_BASE64: PresetFishBase64Entry[] = [');

  for (const item of items) {
    lines.push('    {');
    lines.push(`        id: ${JSON.stringify(item.id)},`);
    lines.push(`        imageData: ${JSON.stringify(item.imageData)},`);
    lines.push('    },');
  }

  lines.push('];');
  lines.push('');
  return `${lines.join('\n')}`;
}

function main() {
  const items = readPresetItems();
  const moduleSource = buildModule(items);

  fs.mkdirSync(path.dirname(OUTPUT_PATH), { recursive: true });
  fs.writeFileSync(OUTPUT_PATH, moduleSource, 'utf8');

  console.log(
    `Wrote ${items.length} preset fish entries to ${path.relative(COCOS_ROOT, OUTPUT_PATH)}`
  );
}

main();
