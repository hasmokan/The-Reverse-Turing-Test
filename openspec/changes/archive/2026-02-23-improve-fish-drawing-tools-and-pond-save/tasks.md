## 1. 场景与 UI 接线

- [x] 1.1 使用 cocos-mcp 审核 `MultiPlayerScene.scene` 的绘制相关节点与组件，确认画笔、橡皮、保存、颜色、笔触大小、撤销控制项绑定状态。
- [x] 1.2 新增或调整绘制工具栏节点，并完成与 `DrawingBoard` / `MultiPlayerController` 的事件绑定，且不破坏现有绘制面板布局。
- [x] 1.3 接入画笔/橡皮/保存所需远程图标 URL，并实现加载失败时的本地兜底显示策略。

## 2. DrawingBoard 工具能力实现

- [x] 2.1 在 `DrawingBoard` 中实现显式工具状态（画笔模式、橡皮模式、当前颜色、笔触大小）及对应切换 API。
- [x] 2.2 将画笔颜色限制为 frontend 规定色板（`#000000`、`#FF2A2A`、`#1F75FE`、`#00CC44`、`#FF9900`），并拒绝或归一化非法颜色输入。
- [x] 2.3 实现笔画历史记录与单步撤销，确保撤销不依赖整画布清空。
- [x] 2.4 统一橡皮白色覆写策略，确保笔触大小在画笔与橡皮模式下都生效。

## 3. 保存提交与入池可靠性

- [x] 3.1 重构绘制提交流程，确保仅“显式保存”会触发鱼创建，绘制过程本身不创建鱼。
- [x] 3.2 加固 `MultiPlayerController.onDrawingCompleted` 提交链路，原子化完成纹理注册、鱼元数据写入与鱼塘可见状态插入。
- [x] 3.3 增加重复提交防护（如提交中锁或提交令牌），确保同一次提交最多创建一条鱼记录。
- [x] 3.4 补充失败处理：绘制捕获或入池失败时保持既有鱼塘状态不变，并给出用户可见错误反馈。

## 4. 验证与契约测试

- [x] 4.1 扩展 scene-contract 测试，验证绘制工具栏节点接线与图标 URL 配置正确。
- [x] 4.2 新增色板约束测试，确保系统仅接受 frontend 规定的 5 个颜色。
- [x] 4.3 新增保存链路测试，覆盖“必须保存才创建”“保存后可见入池”“重复点击不重复插入”。
- [x] 4.4 运行完整 scene-contract 测试集并修复回归，直至全部通过。
